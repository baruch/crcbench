// //////////////////////////////////////////////////////////
// Crc32.cpp
// Copyright (c) 2011-2013 Stephan Brumme. All rights reserved.
// see http://create.stephan-brumme.com/disclaimer.html
//

// g++ -o Crc32 Crc32.cpp -O3 -march=native -mtune=native

#include <stdlib.h>

// define endianess and some integer data types
#ifdef _MSC_VER
  typedef unsigned __int8  uint8_t;
  typedef unsigned __int32 uint32_t;
  typedef          __int32  int32_t;
  #define __LITTLE_ENDIAN 1234
  #define __BIG_ENDIAN    4321
  #define __BYTE_ORDER    __LITTLE_ENDIAN
#else
  // uint8_t, uint32_t, in32_t
  #include <stdint.h>
  // defines __BYTE_ORDER as __LITTLE_ENDIAN or __BIG_ENDIAN
  #include <endian.h>
#endif

/// zlib's CRC32 polynomial
const uint32_t Polynomial = 0x1EDC6F41;

/// swap endianess
static inline uint32_t swap(uint32_t x)
{
#if defined(__GNUC__) || defined(__clang__)
  return __builtin_bswap32(x);
#else
  return (x >> 24) |
        ((x >>  8) & 0x0000FF00) |
        ((x <<  8) & 0x00FF0000) |
         (x << 24);
#endif
}

/// look-up table, already declared above
static const uint32_t Crc32Lookup[8][256] =
{
  //// same algorithm as crc32_bitwise
  //for (int i = 0; i <= 0xFF; i++)
  //{
  //  uint32_t crc = i;
  //  for (int j = 0; j < 8; j++)
  //    crc = (crc >> 1) ^ ((crc & 1) * Polynomial);
  //  Crc32Lookup[0][i] = crc;
  //}
  //// ... and the following slicing-by-8 algorithm (from Intel):
  //// http://www.intel.com/technology/comms/perfnet/download/CRC_generators.pdf
  //// http://sourceforge.net/projects/slicing-by-8/
  //for (int i = 0; i <= 0xFF; i++)
  //{
  //  Crc32Lookup[1][i] = (Crc32Lookup[0][i] >> 8) ^ Crc32Lookup[0][Crc32Lookup[0][i] & 0xFF];
  //  Crc32Lookup[2][i] = (Crc32Lookup[1][i] >> 8) ^ Crc32Lookup[0][Crc32Lookup[1][i] & 0xFF];
  //  Crc32Lookup[3][i] = (Crc32Lookup[2][i] >> 8) ^ Crc32Lookup[0][Crc32Lookup[2][i] & 0xFF];

  //  Crc32Lookup[4][i] = (Crc32Lookup[3][i] >> 8) ^ Crc32Lookup[0][Crc32Lookup[3][i] & 0xFF];
  //  Crc32Lookup[5][i] = (Crc32Lookup[4][i] >> 8) ^ Crc32Lookup[0][Crc32Lookup[4][i] & 0xFF];
  //  Crc32Lookup[6][i] = (Crc32Lookup[5][i] >> 8) ^ Crc32Lookup[0][Crc32Lookup[5][i] & 0xFF];
  //  Crc32Lookup[7][i] = (Crc32Lookup[6][i] >> 8) ^ Crc32Lookup[0][Crc32Lookup[6][i] & 0xFF];
  //}
 
{
0x00000000,0x0A5F4D75,0x14BE9AEA,0x1EE1D79F,0x14C5EB57,0x1E9AA622,0x007B71BD,0x0A243CC8,
0x1433082D,0x1E6C4558,0x008D92C7,0x0AD2DFB2,0x00F6E37A,0x0AA9AE0F,0x14487990,0x1E1734E5,
0x15DECED9,0x1F8183AC,0x01605433,0x0B3F1946,0x011B258E,0x0B4468FB,0x15A5BF64,0x1FFAF211,
0x01EDC6F4,0x0BB28B81,0x15535C1E,0x1F0C116B,0x15282DA3,0x1F7760D6,0x0196B749,0x0BC9FA3C,
0x16054331,0x1C5A0E44,0x02BBD9DB,0x08E494AE,0x02C0A866,0x089FE513,0x167E328C,0x1C217FF9,
0x02364B1C,0x08690669,0x1688D1F6,0x1CD79C83,0x16F3A04B,0x1CACED3E,0x024D3AA1,0x081277D4,
0x03DB8DE8,0x0984C09D,0x17651702,0x1D3A5A77,0x171E66BF,0x1D412BCA,0x03A0FC55,0x09FFB120,
0x17E885C5,0x1DB7C8B0,0x03561F2F,0x0909525A,0x032D6E92,0x097223E7,0x1793F478,0x1DCCB90D,
0x11B258E1,0x1BED1594,0x050CC20B,0x0F538F7E,0x0577B3B6,0x0F28FEC3,0x11C9295C,0x1B966429,
0x058150CC,0x0FDE1DB9,0x113FCA26,0x1B608753,0x1144BB9B,0x1B1BF6EE,0x05FA2171,0x0FA56C04,
0x046C9638,0x0E33DB4D,0x10D20CD2,0x1A8D41A7,0x10A97D6F,0x1AF6301A,0x0417E785,0x0E48AAF0,
0x105F9E15,0x1A00D360,0x04E104FF,0x0EBE498A,0x049A7542,0x0EC53837,0x1024EFA8,0x1A7BA2DD,
0x07B71BD0,0x0DE856A5,0x1309813A,0x1956CC4F,0x1372F087,0x192DBDF2,0x07CC6A6D,0x0D932718,
0x138413FD,0x19DB5E88,0x073A8917,0x0D65C462,0x0741F8AA,0x0D1EB5DF,0x13FF6240,0x19A02F35,
0x1269D509,0x1836987C,0x06D74FE3,0x0C880296,0x06AC3E5E,0x0CF3732B,0x1212A4B4,0x184DE9C1,
0x065ADD24,0x0C059051,0x12E447CE,0x18BB0ABB,0x129F3673,0x18C07B06,0x0621AC99,0x0C7EE1EC,
0x1EDC6F41,0x14832234,0x0A62F5AB,0x003DB8DE,0x0A198416,0x0046C963,0x1EA71EFC,0x14F85389,
0x0AEF676C,0x00B02A19,0x1E51FD86,0x140EB0F3,0x1E2A8C3B,0x1475C14E,0x0A9416D1,0x00CB5BA4,
0x0B02A198,0x015DECED,0x1FBC3B72,0x15E37607,0x1FC74ACF,0x159807BA,0x0B79D025,0x01269D50,
0x1F31A9B5,0x156EE4C0,0x0B8F335F,0x01D07E2A,0x0BF442E2,0x01AB0F97,0x1F4AD808,0x1515957D,
0x08D92C70,0x02866105,0x1C67B69A,0x1638FBEF,0x1C1CC727,0x16438A52,0x08A25DCD,0x02FD10B8,
0x1CEA245D,0x16B56928,0x0854BEB7,0x020BF3C2,0x082FCF0A,0x0270827F,0x1C9155E0,0x16CE1895,
0x1D07E2A9,0x1758AFDC,0x09B97843,0x03E63536,0x09C209FE,0x039D448B,0x1D7C9314,0x1723DE61,
0x0934EA84,0x036BA7F1,0x1D8A706E,0x17D53D1B,0x1DF101D3,0x17AE4CA6,0x094F9B39,0x0310D64C,
0x0F6E37A0,0x05317AD5,0x1BD0AD4A,0x118FE03F,0x1BABDCF7,0x11F49182,0x0F15461D,0x054A0B68,
0x1B5D3F8D,0x110272F8,0x0FE3A567,0x05BCE812,0x0F98D4DA,0x05C799AF,0x1B264E30,0x11790345,
0x1AB0F979,0x10EFB40C,0x0E0E6393,0x04512EE6,0x0E75122E,0x042A5F5B,0x1ACB88C4,0x1094C5B1,
0x0E83F154,0x04DCBC21,0x1A3D6BBE,0x106226CB,0x1A461A03,0x10195776,0x0EF880E9,0x04A7CD9C,
0x196B7491,0x133439E4,0x0DD5EE7B,0x078AA30E,0x0DAE9FC6,0x07F1D2B3,0x1910052C,0x134F4859,
0x0D587CBC,0x070731C9,0x19E6E656,0x13B9AB23,0x199D97EB,0x13C2DA9E,0x0D230D01,0x077C4074,
0x0CB5BA48,0x06EAF73D,0x180B20A2,0x12546DD7,0x1870511F,0x122F1C6A,0x0CCECBF5,0x06918680,
0x1886B265,0x12D9FF10,0x0C38288F,0x066765FA,0x0C435932,0x061C1447,0x18FDC3D8,0x12A28EAD,

},
{
0x00000000,0x0CF92C66,0x19F258CC,0x150B74AA,0x0E5C6F1B,0x02A5437D,0x17AE37D7,0x1B571BB1,
0x1CB8DE36,0x1041F250,0x054A86FA,0x09B3AA9C,0x12E4B12D,0x1E1D9D4B,0x0B16E9E1,0x07EFC587,
0x04C962EF,0x08304E89,0x1D3B3A23,0x11C21645,0x0A950DF4,0x066C2192,0x13675538,0x1F9E795E,
0x1871BCD9,0x148890BF,0x0183E415,0x0D7AC873,0x162DD3C2,0x1AD4FFA4,0x0FDF8B0E,0x0326A768,
0x0992C5DE,0x056BE9B8,0x10609D12,0x1C99B174,0x07CEAAC5,0x0B3786A3,0x1E3CF209,0x12C5DE6F,
0x152A1BE8,0x19D3378E,0x0CD84324,0x00216F42,0x1B7674F3,0x178F5895,0x02842C3F,0x0E7D0059,
0x0D5BA731,0x01A28B57,0x14A9FFFD,0x1850D39B,0x0307C82A,0x0FFEE44C,0x1AF590E6,0x160CBC80,
0x11E37907,0x1D1A5561,0x081121CB,0x04E80DAD,0x1FBF161C,0x13463A7A,0x064D4ED0,0x0AB462B6,
0x13258BBC,0x1FDCA7DA,0x0AD7D370,0x062EFF16,0x1D79E4A7,0x1180C8C1,0x048BBC6B,0x0872900D,
0x0F9D558A,0x036479EC,0x166F0D46,0x1A962120,0x01C13A91,0x0D3816F7,0x1833625D,0x14CA4E3B,
0x17ECE953,0x1B15C535,0x0E1EB19F,0x02E79DF9,0x19B08648,0x1549AA2E,0x0042DE84,0x0CBBF2E2,
0x0B543765,0x07AD1B03,0x12A66FA9,0x1E5F43CF,0x0508587E,0x09F17418,0x1CFA00B2,0x10032CD4,
0x1AB74E62,0x164E6204,0x034516AE,0x0FBC3AC8,0x14EB2179,0x18120D1F,0x0D1979B5,0x01E055D3,
0x060F9054,0x0AF6BC32,0x1FFDC898,0x1304E4FE,0x0853FF4F,0x04AAD329,0x11A1A783,0x1D588BE5,
0x1E7E2C8D,0x128700EB,0x078C7441,0x0B755827,0x10224396,0x1CDB6FF0,0x09D01B5A,0x0529373C,
0x02C6F2BB,0x0E3FDEDD,0x1B34AA77,0x17CD8611,0x0C9A9DA0,0x0063B1C6,0x1568C56C,0x1991E90A,
0x1BF3C9FB,0x170AE59D,0x02019137,0x0EF8BD51,0x15AFA6E0,0x19568A86,0x0C5DFE2C,0x00A4D24A,
0x074B17CD,0x0BB23BAB,0x1EB94F01,0x12406367,0x091778D6,0x05EE54B0,0x10E5201A,0x1C1C0C7C,
0x1F3AAB14,0x13C38772,0x06C8F3D8,0x0A31DFBE,0x1166C40F,0x1D9FE869,0x08949CC3,0x046DB0A5,
0x03827522,0x0F7B5944,0x1A702DEE,0x16890188,0x0DDE1A39,0x0127365F,0x142C42F5,0x18D56E93,
0x12610C25,0x1E982043,0x0B9354E9,0x076A788F,0x1C3D633E,0x10C44F58,0x05CF3BF2,0x09361794,
0x0ED9D213,0x0220FE75,0x172B8ADF,0x1BD2A6B9,0x0085BD08,0x0C7C916E,0x1977E5C4,0x158EC9A2,
0x16A86ECA,0x1A5142AC,0x0F5A3606,0x03A31A60,0x18F401D1,0x140D2DB7,0x0106591D,0x0DFF757B,
0x0A10B0FC,0x06E99C9A,0x13E2E830,0x1F1BC456,0x044CDFE7,0x08B5F381,0x1DBE872B,0x1147AB4D,
0x08D64247,0x042F6E21,0x11241A8B,0x1DDD36ED,0x068A2D5C,0x0A73013A,0x1F787590,0x138159F6,
0x146E9C71,0x1897B017,0x0D9CC4BD,0x0165E8DB,0x1A32F36A,0x16CBDF0C,0x03C0ABA6,0x0F3987C0,
0x0C1F20A8,0x00E60CCE,0x15ED7864,0x19145402,0x02434FB3,0x0EBA63D5,0x1BB1177F,0x17483B19,
0x10A7FE9E,0x1C5ED2F8,0x0955A652,0x05AC8A34,0x1EFB9185,0x1202BDE3,0x0709C949,0x0BF0E52F,
0x01448799,0x0DBDABFF,0x18B6DF55,0x144FF333,0x0F18E882,0x03E1C4E4,0x16EAB04E,0x1A139C28,
0x1DFC59AF,0x110575C9,0x040E0163,0x08F72D05,0x13A036B4,0x1F591AD2,0x0A526E78,0x06AB421E,
0x058DE576,0x0974C910,0x1C7FBDBA,0x108691DC,0x0BD18A6D,0x0728A60B,0x1223D2A1,0x1EDAFEC7,
0x19353B40,0x15CC1726,0x00C7638C,0x0C3E4FEA,0x1769545B,0x1B90783D,0x0E9B0C97,0x026220F1,

},
{
0x00000000,0x07C09341,0x0F812682,0x0841B5C3,0x1F024D04,0x18C2DE45,0x10836B86,0x1743F8C7,
0x03BC448B,0x047CD7CA,0x0C3D6209,0x0BFDF148,0x1CBE098F,0x1B7E9ACE,0x133F2F0D,0x14FFBC4C,
0x07788916,0x00B81A57,0x08F9AF94,0x0F393CD5,0x187AC412,0x1FBA5753,0x17FBE290,0x103B71D1,
0x04C4CD9D,0x03045EDC,0x0B45EB1F,0x0C85785E,0x1BC68099,0x1C0613D8,0x1447A61B,0x1387355A,
0x0EF1122C,0x0931816D,0x017034AE,0x06B0A7EF,0x11F35F28,0x1633CC69,0x1E7279AA,0x19B2EAEB,
0x0D4D56A7,0x0A8DC5E6,0x02CC7025,0x050CE364,0x124F1BA3,0x158F88E2,0x1DCE3D21,0x1A0EAE60,
0x09899B3A,0x0E49087B,0x0608BDB8,0x01C82EF9,0x168BD63E,0x114B457F,0x190AF0BC,0x1ECA63FD,
0x0A35DFB1,0x0DF54CF0,0x05B4F933,0x02746A72,0x153792B5,0x12F701F4,0x1AB6B437,0x1D762776,
0x1DE22458,0x1A22B719,0x126302DA,0x15A3919B,0x02E0695C,0x0520FA1D,0x0D614FDE,0x0AA1DC9F,
0x1E5E60D3,0x199EF392,0x11DF4651,0x161FD510,0x015C2DD7,0x069CBE96,0x0EDD0B55,0x091D9814,
0x1A9AAD4E,0x1D5A3E0F,0x151B8BCC,0x12DB188D,0x0598E04A,0x0258730B,0x0A19C6C8,0x0DD95589,
0x1926E9C5,0x1EE67A84,0x16A7CF47,0x11675C06,0x0624A4C1,0x01E43780,0x09A58243,0x0E651102,
0x13133674,0x14D3A535,0x1C9210F6,0x1B5283B7,0x0C117B70,0x0BD1E831,0x03905DF2,0x0450CEB3,
0x10AF72FF,0x176FE1BE,0x1F2E547D,0x18EEC73C,0x0FAD3FFB,0x086DACBA,0x002C1979,0x07EC8A38,
0x146BBF62,0x13AB2C23,0x1BEA99E0,0x1C2A0AA1,0x0B69F266,0x0CA96127,0x04E8D4E4,0x032847A5,
0x17D7FBE9,0x101768A8,0x1856DD6B,0x1F964E2A,0x08D5B6ED,0x0F1525AC,0x0754906F,0x0094032E,
0x067C9633,0x01BC0572,0x09FDB0B1,0x0E3D23F0,0x197EDB37,0x1EBE4876,0x16FFFDB5,0x113F6EF4,
0x05C0D2B8,0x020041F9,0x0A41F43A,0x0D81677B,0x1AC29FBC,0x1D020CFD,0x1543B93E,0x12832A7F,
0x01041F25,0x06C48C64,0x0E8539A7,0x0945AAE6,0x1E065221,0x19C6C160,0x118774A3,0x1647E7E2,
0x02B85BAE,0x0578C8EF,0x0D397D2C,0x0AF9EE6D,0x1DBA16AA,0x1A7A85EB,0x123B3028,0x15FBA369,
0x088D841F,0x0F4D175E,0x070CA29D,0x00CC31DC,0x178FC91B,0x104F5A5A,0x180EEF99,0x1FCE7CD8,
0x0B31C094,0x0CF153D5,0x04B0E616,0x03707557,0x14338D90,0x13F31ED1,0x1BB2AB12,0x1C723853,
0x0FF50D09,0x08359E48,0x00742B8B,0x07B4B8CA,0x10F7400D,0x1737D34C,0x1F76668F,0x18B6F5CE,
0x0C494982,0x0B89DAC3,0x03C86F00,0x0408FC41,0x134B0486,0x148B97C7,0x1CCA2204,0x1B0AB145,
0x1B9EB26B,0x1C5E212A,0x141F94E9,0x13DF07A8,0x049CFF6F,0x035C6C2E,0x0B1DD9ED,0x0CDD4AAC,
0x1822F6E0,0x1FE265A1,0x17A3D062,0x10634323,0x0720BBE4,0x00E028A5,0x08A19D66,0x0F610E27,
0x1CE63B7D,0x1B26A83C,0x13671DFF,0x14A78EBE,0x03E47679,0x0424E538,0x0C6550FB,0x0BA5C3BA,
0x1F5A7FF6,0x189AECB7,0x10DB5974,0x171BCA35,0x005832F2,0x0798A1B3,0x0FD91470,0x08198731,
0x156FA047,0x12AF3306,0x1AEE86C5,0x1D2E1584,0x0A6DED43,0x0DAD7E02,0x05ECCBC1,0x022C5880,
0x16D3E4CC,0x1113778D,0x1952C24E,0x1E92510F,0x09D1A9C8,0x0E113A89,0x06508F4A,0x01901C0B,
0x12172951,0x15D7BA10,0x1D960FD3,0x1A569C92,0x0D156455,0x0AD5F714,0x029442D7,0x0554D196,
0x11AB6DDA,0x166BFE9B,0x1E2A4B58,0x19EAD819,0x0EA920DE,0x0969B39F,0x0128065C,0x06E8951D,

},
{
0x00000000,0x1BEAD507,0x0A6D748D,0x1187A18A,0x14DAE91A,0x0F303C1D,0x1EB79D97,0x055D4890,
0x140D0CB7,0x0FE7D9B0,0x1E60783A,0x058AAD3D,0x00D7E5AD,0x1B3D30AA,0x0ABA9120,0x11504427,
0x15A2C7ED,0x0E4812EA,0x1FCFB360,0x04256667,0x01782EF7,0x1A92FBF0,0x0B155A7A,0x10FF8F7D,
0x01AFCB5A,0x1A451E5D,0x0BC2BFD7,0x10286AD0,0x15752240,0x0E9FF747,0x1F1856CD,0x04F283CA,
0x16FD5159,0x0D17845E,0x1C9025D4,0x077AF0D3,0x0227B843,0x19CD6D44,0x084ACCCE,0x13A019C9,
0x02F05DEE,0x191A88E9,0x089D2963,0x1377FC64,0x162AB4F4,0x0DC061F3,0x1C47C079,0x07AD157E,
0x035F96B4,0x18B543B3,0x0932E239,0x12D8373E,0x17857FAE,0x0C6FAAA9,0x1DE80B23,0x0602DE24,
0x17529A03,0x0CB84F04,0x1D3FEE8E,0x06D53B89,0x03887319,0x1862A61E,0x09E50794,0x120FD293,
0x10427C31,0x0BA8A936,0x1A2F08BC,0x01C5DDBB,0x0498952B,0x1F72402C,0x0EF5E1A6,0x151F34A1,
0x044F7086,0x1FA5A581,0x0E22040B,0x15C8D10C,0x1095999C,0x0B7F4C9B,0x1AF8ED11,0x01123816,
0x05E0BBDC,0x1E0A6EDB,0x0F8DCF51,0x14671A56,0x113A52C6,0x0AD087C1,0x1B57264B,0x00BDF34C,
0x11EDB76B,0x0A07626C,0x1B80C3E6,0x006A16E1,0x05375E71,0x1EDD8B76,0x0F5A2AFC,0x14B0FFFB,
0x06BF2D68,0x1D55F86F,0x0CD259E5,0x17388CE2,0x1265C472,0x098F1175,0x1808B0FF,0x03E265F8,
0x12B221DF,0x0958F4D8,0x18DF5552,0x03358055,0x0668C8C5,0x1D821DC2,0x0C05BC48,0x17EF694F,
0x131DEA85,0x08F73F82,0x19709E08,0x029A4B0F,0x07C7039F,0x1C2DD698,0x0DAA7712,0x1640A215,
0x0710E632,0x1CFA3335,0x0D7D92BF,0x169747B8,0x13CA0F28,0x0820DA2F,0x19A77BA5,0x024DAEA2,
0x1D3C26E1,0x06D6F3E6,0x1751526C,0x0CBB876B,0x09E6CFFB,0x120C1AFC,0x038BBB76,0x18616E71,
0x09312A56,0x12DBFF51,0x035C5EDB,0x18B68BDC,0x1DEBC34C,0x0601164B,0x1786B7C1,0x0C6C62C6,
0x089EE10C,0x1374340B,0x02F39581,0x19194086,0x1C440816,0x07AEDD11,0x16297C9B,0x0DC3A99C,
0x1C93EDBB,0x077938BC,0x16FE9936,0x0D144C31,0x084904A1,0x13A3D1A6,0x0224702C,0x19CEA52B,
0x0BC177B8,0x102BA2BF,0x01AC0335,0x1A46D632,0x1F1B9EA2,0x04F14BA5,0x1576EA2F,0x0E9C3F28,
0x1FCC7B0F,0x0426AE08,0x15A10F82,0x0E4BDA85,0x0B169215,0x10FC4712,0x017BE698,0x1A91339F,
0x1E63B055,0x05896552,0x140EC4D8,0x0FE411DF,0x0AB9594F,0x11538C48,0x00D42DC2,0x1B3EF8C5,
0x0A6EBCE2,0x118469E5,0x0003C86F,0x1BE91D68,0x1EB455F8,0x055E80FF,0x14D92175,0x0F33F472,
0x0D7E5AD0,0x16948FD7,0x07132E5D,0x1CF9FB5A,0x19A4B3CA,0x024E66CD,0x13C9C747,0x08231240,
0x19735667,0x02998360,0x131E22EA,0x08F4F7ED,0x0DA9BF7D,0x16436A7A,0x07C4CBF0,0x1C2E1EF7,
0x18DC9D3D,0x0336483A,0x12B1E9B0,0x095B3CB7,0x0C067427,0x17ECA120,0x066B00AA,0x1D81D5AD,
0x0CD1918A,0x173B448D,0x06BCE507,0x1D563000,0x180B7890,0x03E1AD97,0x12660C1D,0x098CD91A,
0x1B830B89,0x0069DE8E,0x11EE7F04,0x0A04AA03,0x0F59E293,0x14B33794,0x0534961E,0x1EDE4319,
0x0F8E073E,0x1464D239,0x05E373B3,0x1E09A6B4,0x1B54EE24,0x00BE3B23,0x11399AA9,0x0AD34FAE,
0x0E21CC64,0x15CB1963,0x044CB8E9,0x1FA66DEE,0x1AFB257E,0x0111F079,0x109651F3,0x0B7C84F4,
0x1A2CC0D3,0x01C615D4,0x1041B45E,0x0BAB6159,0x0EF629C9,0x151CFCCE,0x049B5D44,0x1F718843,

},
{
0x00000000,0x0A3FD61D,0x147FAC3A,0x1E407A27,0x154786F7,0x1F7850EA,0x01382ACD,0x0B07FCD0,
0x1737D36D,0x1D080570,0x03487F57,0x0977A94A,0x0270559A,0x084F8387,0x160FF9A0,0x1C302FBD,
0x13D77859,0x19E8AE44,0x07A8D463,0x0D97027E,0x0690FEAE,0x0CAF28B3,0x12EF5294,0x18D08489,
0x04E0AB34,0x0EDF7D29,0x109F070E,0x1AA0D113,0x11A72DC3,0x1B98FBDE,0x05D881F9,0x0FE757E4,
0x1A162E31,0x1029F82C,0x0E69820B,0x04565416,0x0F51A8C6,0x056E7EDB,0x1B2E04FC,0x1111D2E1,
0x0D21FD5C,0x071E2B41,0x195E5166,0x1361877B,0x18667BAB,0x1259ADB6,0x0C19D791,0x0626018C,
0x09C15668,0x03FE8075,0x1DBEFA52,0x17812C4F,0x1C86D09F,0x16B90682,0x08F97CA5,0x02C6AAB8,
0x1EF68505,0x14C95318,0x0A89293F,0x00B6FF22,0x0BB103F2,0x018ED5EF,0x1FCEAFC8,0x15F179D5,
0x099482E1,0x03AB54FC,0x1DEB2EDB,0x17D4F8C6,0x1CD30416,0x16ECD20B,0x08ACA82C,0x02937E31,
0x1EA3518C,0x149C8791,0x0ADCFDB6,0x00E32BAB,0x0BE4D77B,0x01DB0166,0x1F9B7B41,0x15A4AD5C,
0x1A43FAB8,0x107C2CA5,0x0E3C5682,0x0403809F,0x0F047C4F,0x053BAA52,0x1B7BD075,0x11440668,
0x0D7429D5,0x074BFFC8,0x190B85EF,0x133453F2,0x1833AF22,0x120C793F,0x0C4C0318,0x0673D505,
0x1382ACD0,0x19BD7ACD,0x07FD00EA,0x0DC2D6F7,0x06C52A27,0x0CFAFC3A,0x12BA861D,0x18855000,
0x04B57FBD,0x0E8AA9A0,0x10CAD387,0x1AF5059A,0x11F2F94A,0x1BCD2F57,0x058D5570,0x0FB2836D,
0x0055D489,0x0A6A0294,0x142A78B3,0x1E15AEAE,0x1512527E,0x1F2D8463,0x016DFE44,0x0B522859,
0x176207E4,0x1D5DD1F9,0x031DABDE,0x09227DC3,0x02258113,0x081A570E,0x165A2D29,0x1C65FB34,
0x132905C2,0x1916D3DF,0x0756A9F8,0x0D697FE5,0x066E8335,0x0C515528,0x12112F0F,0x182EF912,
0x041ED6AF,0x0E2100B2,0x10617A95,0x1A5EAC88,0x11595058,0x1B668645,0x0526FC62,0x0F192A7F,
0x00FE7D9B,0x0AC1AB86,0x1481D1A1,0x1EBE07BC,0x15B9FB6C,0x1F862D71,0x01C65756,0x0BF9814B,
0x17C9AEF6,0x1DF678EB,0x03B602CC,0x0989D4D1,0x028E2801,0x08B1FE1C,0x16F1843B,0x1CCE5226,
0x093F2BF3,0x0300FDEE,0x1D4087C9,0x177F51D4,0x1C78AD04,0x16477B19,0x0807013E,0x0238D723,
0x1E08F89E,0x14372E83,0x0A7754A4,0x004882B9,0x0B4F7E69,0x0170A874,0x1F30D253,0x150F044E,
0x1AE853AA,0x10D785B7,0x0E97FF90,0x04A8298D,0x0FAFD55D,0x05900340,0x1BD07967,0x11EFAF7A,
0x0DDF80C7,0x07E056DA,0x19A02CFD,0x139FFAE0,0x18980630,0x12A7D02D,0x0CE7AA0A,0x06D87C17,
0x1ABD8723,0x1082513E,0x0EC22B19,0x04FDFD04,0x0FFA01D4,0x05C5D7C9,0x1B85ADEE,0x11BA7BF3,
0x0D8A544E,0x07B58253,0x19F5F874,0x13CA2E69,0x18CDD2B9,0x12F204A4,0x0CB27E83,0x068DA89E,
0x096AFF7A,0x03552967,0x1D155340,0x172A855D,0x1C2D798D,0x1612AF90,0x0852D5B7,0x026D03AA,
0x1E5D2C17,0x1462FA0A,0x0A22802D,0x001D5630,0x0B1AAAE0,0x01257CFD,0x1F6506DA,0x155AD0C7,
0x00ABA912,0x0A947F0F,0x14D40528,0x1EEBD335,0x15EC2FE5,0x1FD3F9F8,0x019383DF,0x0BAC55C2,
0x179C7A7F,0x1DA3AC62,0x03E3D645,0x09DC0058,0x02DBFC88,0x08E42A95,0x16A450B2,0x1C9B86AF,
0x137CD14B,0x19430756,0x07037D71,0x0D3CAB6C,0x063B57BC,0x0C0481A1,0x1244FB86,0x187B2D9B,
0x044B0226,0x0E74D43B,0x1034AE1C,0x1A0B7801,0x110C84D1,0x1B3352CC,0x057328EB,0x0F4CFEF6,

},
{
0x00000000,0x1F7D5F00,0x03426083,0x1C3F3F83,0x0684C106,0x19F99E06,0x05C6A185,0x1ABBFE85,
0x0D09820C,0x1274DD0C,0x0E4BE28F,0x1136BD8F,0x0B8D430A,0x14F01C0A,0x08CF2389,0x17B27C89,
0x1A130418,0x056E5B18,0x1951649B,0x062C3B9B,0x1C97C51E,0x03EA9A1E,0x1FD5A59D,0x00A8FA9D,
0x171A8614,0x0867D914,0x1458E697,0x0B25B997,0x119E4712,0x0EE31812,0x12DC2791,0x0DA17891,
0x099ED6B3,0x16E389B3,0x0ADCB630,0x15A1E930,0x0F1A17B5,0x106748B5,0x0C587736,0x13252836,
0x049754BF,0x1BEA0BBF,0x07D5343C,0x18A86B3C,0x021395B9,0x1D6ECAB9,0x0151F53A,0x1E2CAA3A,
0x138DD2AB,0x0CF08DAB,0x10CFB228,0x0FB2ED28,0x150913AD,0x0A744CAD,0x164B732E,0x09362C2E,
0x1E8450A7,0x01F90FA7,0x1DC63024,0x02BB6F24,0x180091A1,0x077DCEA1,0x1B42F122,0x043FAE22,
0x133DAD66,0x0C40F266,0x107FCDE5,0x0F0292E5,0x15B96C60,0x0AC43360,0x16FB0CE3,0x098653E3,
0x1E342F6A,0x0149706A,0x1D764FE9,0x020B10E9,0x18B0EE6C,0x07CDB16C,0x1BF28EEF,0x048FD1EF,
0x092EA97E,0x1653F67E,0x0A6CC9FD,0x151196FD,0x0FAA6878,0x10D73778,0x0CE808FB,0x139557FB,
0x04272B72,0x1B5A7472,0x07654BF1,0x181814F1,0x02A3EA74,0x1DDEB574,0x01E18AF7,0x1E9CD5F7,
0x1AA37BD5,0x05DE24D5,0x19E11B56,0x069C4456,0x1C27BAD3,0x035AE5D3,0x1F65DA50,0x00188550,
0x17AAF9D9,0x08D7A6D9,0x14E8995A,0x0B95C65A,0x112E38DF,0x0E5367DF,0x126C585C,0x0D11075C,
0x00B07FCD,0x1FCD20CD,0x03F21F4E,0x1C8F404E,0x0634BECB,0x1949E1CB,0x0576DE48,0x1A0B8148,
0x0DB9FDC1,0x12C4A2C1,0x0EFB9D42,0x1186C242,0x0B3D3CC7,0x144063C7,0x087F5C44,0x17020344,
0x1BC3844F,0x04BEDB4F,0x1881E4CC,0x07FCBBCC,0x1D474549,0x023A1A49,0x1E0525CA,0x01787ACA,
0x16CA0643,0x09B75943,0x158866C0,0x0AF539C0,0x104EC745,0x0F339845,0x130CA7C6,0x0C71F8C6,
0x01D08057,0x1EADDF57,0x0292E0D4,0x1DEFBFD4,0x07544151,0x18291E51,0x041621D2,0x1B6B7ED2,
0x0CD9025B,0x13A45D5B,0x0F9B62D8,0x10E63DD8,0x0A5DC35D,0x15209C5D,0x091FA3DE,0x1662FCDE,
0x125D52FC,0x0D200DFC,0x111F327F,0x0E626D7F,0x14D993FA,0x0BA4CCFA,0x179BF379,0x08E6AC79,
0x1F54D0F0,0x00298FF0,0x1C16B073,0x036BEF73,0x19D011F6,0x06AD4EF6,0x1A927175,0x05EF2E75,
0x084E56E4,0x173309E4,0x0B0C3667,0x14716967,0x0ECA97E2,0x11B7C8E2,0x0D88F761,0x12F5A861,
0x0547D4E8,0x1A3A8BE8,0x0605B46B,0x1978EB6B,0x03C315EE,0x1CBE4AEE,0x0081756D,0x1FFC2A6D,
0x08FE2929,0x17837629,0x0BBC49AA,0x14C116AA,0x0E7AE82F,0x1107B72F,0x0D3888AC,0x1245D7AC,
0x05F7AB25,0x1A8AF425,0x06B5CBA6,0x19C894A6,0x03736A23,0x1C0E3523,0x00310AA0,0x1F4C55A0,
0x12ED2D31,0x0D907231,0x11AF4DB2,0x0ED212B2,0x1469EC37,0x0B14B337,0x172B8CB4,0x0856D3B4,
0x1FE4AF3D,0x0099F03D,0x1CA6CFBE,0x03DB90BE,0x19606E3B,0x061D313B,0x1A220EB8,0x055F51B8,
0x0160FF9A,0x1E1DA09A,0x02229F19,0x1D5FC019,0x07E43E9C,0x1899619C,0x04A65E1F,0x1BDB011F,
0x0C697D96,0x13142296,0x0F2B1D15,0x10564215,0x0AEDBC90,0x1590E390,0x09AFDC13,0x16D28313,
0x1B73FB82,0x040EA482,0x18319B01,0x074CC401,0x1DF73A84,0x028A6584,0x1EB55A07,0x01C80507,
0x167A798E,0x0907268E,0x1538190D,0x0A45460D,0x10FEB888,0x0F83E788,0x13BCD80B,0x0CC1870B,

},
{
0x00000000,0x001F7D5F,0x003EFABE,0x002187E1,0x007DF57C,0x00628823,0x00430FC2,0x005C729D,
0x00FBEAF8,0x00E497A7,0x00C51046,0x00DA6D19,0x00861F84,0x009962DB,0x00B8E53A,0x00A79865,
0x01F7D5F0,0x01E8A8AF,0x01C92F4E,0x01D65211,0x018A208C,0x01955DD3,0x01B4DA32,0x01ABA76D,
0x010C3F08,0x01134257,0x0132C5B6,0x012DB8E9,0x0171CA74,0x016EB72B,0x014F30CA,0x01504D95,
0x03EFABE0,0x03F0D6BF,0x03D1515E,0x03CE2C01,0x03925E9C,0x038D23C3,0x03ACA422,0x03B3D97D,
0x03144118,0x030B3C47,0x032ABBA6,0x0335C6F9,0x0369B464,0x0376C93B,0x03574EDA,0x03483385,
0x02187E10,0x0207034F,0x022684AE,0x0239F9F1,0x02658B6C,0x027AF633,0x025B71D2,0x02440C8D,
0x02E394E8,0x02FCE9B7,0x02DD6E56,0x02C21309,0x029E6194,0x02811CCB,0x02A09B2A,0x02BFE675,
0x07DF57C0,0x07C02A9F,0x07E1AD7E,0x07FED021,0x07A2A2BC,0x07BDDFE3,0x079C5802,0x0783255D,
0x0724BD38,0x073BC067,0x071A4786,0x07053AD9,0x07594844,0x0746351B,0x0767B2FA,0x0778CFA5,
0x06288230,0x0637FF6F,0x0616788E,0x060905D1,0x0655774C,0x064A0A13,0x066B8DF2,0x0674F0AD,
0x06D368C8,0x06CC1597,0x06ED9276,0x06F2EF29,0x06AE9DB4,0x06B1E0EB,0x0690670A,0x068F1A55,
0x0430FC20,0x042F817F,0x040E069E,0x04117BC1,0x044D095C,0x04527403,0x0473F3E2,0x046C8EBD,
0x04CB16D8,0x04D46B87,0x04F5EC66,0x04EA9139,0x04B6E3A4,0x04A99EFB,0x0488191A,0x04976445,
0x05C729D0,0x05D8548F,0x05F9D36E,0x05E6AE31,0x05BADCAC,0x05A5A1F3,0x05842612,0x059B5B4D,
0x053CC328,0x0523BE77,0x05023996,0x051D44C9,0x05413654,0x055E4B0B,0x057FCCEA,0x0560B1B5,
0x0FBEAF80,0x0FA1D2DF,0x0F80553E,0x0F9F2861,0x0FC35AFC,0x0FDC27A3,0x0FFDA042,0x0FE2DD1D,
0x0F454578,0x0F5A3827,0x0F7BBFC6,0x0F64C299,0x0F38B004,0x0F27CD5B,0x0F064ABA,0x0F1937E5,
0x0E497A70,0x0E56072F,0x0E7780CE,0x0E68FD91,0x0E348F0C,0x0E2BF253,0x0E0A75B2,0x0E1508ED,
0x0EB29088,0x0EADEDD7,0x0E8C6A36,0x0E931769,0x0ECF65F4,0x0ED018AB,0x0EF19F4A,0x0EEEE215,
0x0C510460,0x0C4E793F,0x0C6FFEDE,0x0C708381,0x0C2CF11C,0x0C338C43,0x0C120BA2,0x0C0D76FD,
0x0CAAEE98,0x0CB593C7,0x0C941426,0x0C8B6979,0x0CD71BE4,0x0CC866BB,0x0CE9E15A,0x0CF69C05,
0x0DA6D190,0x0DB9ACCF,0x0D982B2E,0x0D875671,0x0DDB24EC,0x0DC459B3,0x0DE5DE52,0x0DFAA30D,
0x0D5D3B68,0x0D424637,0x0D63C1D6,0x0D7CBC89,0x0D20CE14,0x0D3FB34B,0x0D1E34AA,0x0D0149F5,
0x0861F840,0x087E851F,0x085F02FE,0x08407FA1,0x081C0D3C,0x08037063,0x0822F782,0x083D8ADD,
0x089A12B8,0x08856FE7,0x08A4E806,0x08BB9559,0x08E7E7C4,0x08F89A9B,0x08D91D7A,0x08C66025,
0x09962DB0,0x098950EF,0x09A8D70E,0x09B7AA51,0x09EBD8CC,0x09F4A593,0x09D52272,0x09CA5F2D,
0x096DC748,0x0972BA17,0x09533DF6,0x094C40A9,0x09103234,0x090F4F6B,0x092EC88A,0x0931B5D5,
0x0B8E53A0,0x0B912EFF,0x0BB0A91E,0x0BAFD441,0x0BF3A6DC,0x0BECDB83,0x0BCD5C62,0x0BD2213D,
0x0B75B958,0x0B6AC407,0x0B4B43E6,0x0B543EB9,0x0B084C24,0x0B17317B,0x0B36B69A,0x0B29CBC5,
0x0A798650,0x0A66FB0F,0x0A477CEE,0x0A5801B1,0x0A04732C,0x0A1B0E73,0x0A3A8992,0x0A25F4CD,
0x0A826CA8,0x0A9D11F7,0x0ABC9616,0x0AA3EB49,0x0AFF99D4,0x0AE0E48B,0x0AC1636A,0x0ADE1E35,

},
{
0x00000000,0x1A7BBDA0,0x094FA5C3,0x13341863,0x129F4B86,0x08E4F626,0x1BD0EE45,0x01AB53E5,
0x1886498F,0x02FDF42F,0x11C9EC4C,0x0BB251EC,0x0A190209,0x1062BFA9,0x0356A7CA,0x192D1A6A,
0x0CB44D9D,0x16CFF03D,0x05FBE85E,0x1F8055FE,0x1E2B061B,0x0450BBBB,0x1764A3D8,0x0D1F1E78,
0x14320412,0x0E49B9B2,0x1D7DA1D1,0x07061C71,0x06AD4F94,0x1CD6F234,0x0FE2EA57,0x159957F7,
0x19689B3A,0x0313269A,0x10273EF9,0x0A5C8359,0x0BF7D0BC,0x118C6D1C,0x02B8757F,0x18C3C8DF,
0x01EED2B5,0x1B956F15,0x08A17776,0x12DACAD6,0x13719933,0x090A2493,0x1A3E3CF0,0x00458150,
0x15DCD6A7,0x0FA76B07,0x1C937364,0x06E8CEC4,0x07439D21,0x1D382081,0x0E0C38E2,0x14778542,
0x0D5A9F28,0x17212288,0x04153AEB,0x1E6E874B,0x1FC5D4AE,0x05BE690E,0x168A716D,0x0CF1CCCD,
0x0F69E8F7,0x15125557,0x06264D34,0x1C5DF094,0x1DF6A371,0x078D1ED1,0x14B906B2,0x0EC2BB12,
0x17EFA178,0x0D941CD8,0x1EA004BB,0x04DBB91B,0x0570EAFE,0x1F0B575E,0x0C3F4F3D,0x1644F29D,
0x03DDA56A,0x19A618CA,0x0A9200A9,0x10E9BD09,0x1142EEEC,0x0B39534C,0x180D4B2F,0x0276F68F,
0x1B5BECE5,0x01205145,0x12144926,0x086FF486,0x09C4A763,0x13BF1AC3,0x008B02A0,0x1AF0BF00,
0x160173CD,0x0C7ACE6D,0x1F4ED60E,0x05356BAE,0x049E384B,0x1EE585EB,0x0DD19D88,0x17AA2028,
0x0E873A42,0x14FC87E2,0x07C89F81,0x1DB32221,0x1C1871C4,0x0663CC64,0x1557D407,0x0F2C69A7,
0x1AB53E50,0x00CE83F0,0x13FA9B93,0x09812633,0x082A75D6,0x1251C876,0x0165D015,0x1B1E6DB5,
0x023377DF,0x1848CA7F,0x0B7CD21C,0x11076FBC,0x10AC3C59,0x0AD781F9,0x19E3999A,0x0398243A,
0x1ED3D1EE,0x04A86C4E,0x179C742D,0x0DE7C98D,0x0C4C9A68,0x163727C8,0x05033FAB,0x1F78820B,
0x06559861,0x1C2E25C1,0x0F1A3DA2,0x15618002,0x14CAD3E7,0x0EB16E47,0x1D857624,0x07FECB84,
0x12679C73,0x081C21D3,0x1B2839B0,0x01538410,0x00F8D7F5,0x1A836A55,0x09B77236,0x13CCCF96,
0x0AE1D5FC,0x109A685C,0x03AE703F,0x19D5CD9F,0x187E9E7A,0x020523DA,0x11313BB9,0x0B4A8619,
0x07BB4AD4,0x1DC0F774,0x0EF4EF17,0x148F52B7,0x15240152,0x0F5FBCF2,0x1C6BA491,0x06101931,
0x1F3D035B,0x0546BEFB,0x1672A698,0x0C091B38,0x0DA248DD,0x17D9F57D,0x04EDED1E,0x1E9650BE,
0x0B0F0749,0x1174BAE9,0x0240A28A,0x183B1F2A,0x19904CCF,0x03EBF16F,0x10DFE90C,0x0AA454AC,
0x13894EC6,0x09F2F366,0x1AC6EB05,0x00BD56A5,0x01160540,0x1B6DB8E0,0x0859A083,0x12221D23,
0x11BA3919,0x0BC184B9,0x18F59CDA,0x028E217A,0x0325729F,0x195ECF3F,0x0A6AD75C,0x10116AFC,
0x093C7096,0x1347CD36,0x0073D555,0x1A0868F5,0x1BA33B10,0x01D886B0,0x12EC9ED3,0x08972373,
0x1D0E7484,0x0775C924,0x1441D147,0x0E3A6CE7,0x0F913F02,0x15EA82A2,0x06DE9AC1,0x1CA52761,
0x05883D0B,0x1FF380AB,0x0CC798C8,0x16BC2568,0x1717768D,0x0D6CCB2D,0x1E58D34E,0x04236EEE,
0x08D2A223,0x12A91F83,0x019D07E0,0x1BE6BA40,0x1A4DE9A5,0x00365405,0x13024C66,0x0979F1C6,
0x1054EBAC,0x0A2F560C,0x191B4E6F,0x0360F3CF,0x02CBA02A,0x18B01D8A,0x0B8405E9,0x11FFB849,
0x0466EFBE,0x1E1D521E,0x0D294A7D,0x1752F7DD,0x16F9A438,0x0C821998,0x1FB601FB,0x05CDBC5B,
0x1CE0A631,0x069B1B91,0x15AF03F2,0x0FD4BE52,0x0E7FEDB7,0x14045017,0x07304874,0x1D4BF5D4,

}
};




/// compute CRC32 (bitwise algorithm)
uint32_t crc32_bitwise(const void* data, size_t length, uint32_t previousCrc32)
{
  uint32_t crc = ~previousCrc32; // same as previousCrc32 ^ 0xFFFFFFFF
  const uint8_t* current = (const uint8_t*) data;

  while (length-- > 0)
  {
    crc ^= *current++;

	int j;
    for (j = 0; j < 8; j++)
    {
      // branch-free, version 1
      //crc = (crc >> 1) ^ (crc & 1)*Polynomial;
      // branch-free, version 2
      crc = (crc >> 1) ^ (-(int32_t)(crc & 1) & Polynomial);

      // branching, much slower:
      //if (crc & 1)
      //  crc = (crc >> 1) ^ Polynomial;
      //else
      //  crc =  crc >> 1;
    }
  }

  return ~crc; // same as crc ^ 0xFFFFFFFF
}


/// compute CRC32 (half-byte algoritm)
uint32_t crc32_halfbyte(const void* data, size_t length, uint32_t previousCrc32)
{
  uint32_t crc = ~previousCrc32; // same as previousCrc32 ^ 0xFFFFFFFF
  const uint8_t* current = (const uint8_t*) data;

  /// look-up table for half-byte, same as crc32Lookup[0][16*i]
  static const uint32_t Crc32Lookup16[16] =
  {
    0x00000000,0x1DB71064,0x3B6E20C8,0x26D930AC,0x76DC4190,0x6B6B51F4,0x4DB26158,0x5005713C,
    0xEDB88320,0xF00F9344,0xD6D6A3E8,0xCB61B38C,0x9B64C2B0,0x86D3D2D4,0xA00AE278,0xBDBDF21C
  };

  while (length-- > 0)
  {
    crc = Crc32Lookup16[(crc ^  *current      ) & 0x0F] ^ (crc >> 4);
    crc = Crc32Lookup16[(crc ^ (*current >> 4)) & 0x0F] ^ (crc >> 4);
    current++;
  }

  return ~crc; // same as crc ^ 0xFFFFFFFF
}


/// compute CRC32 (standard algorithm)
uint32_t crc32_1byte(const void* data, size_t length, uint32_t previousCrc32)
{
  uint32_t crc = ~previousCrc32; // same as previousCrc32 ^ 0xFFFFFFFF
  const uint8_t* current = (const uint8_t*) data;

  while (length-- > 0)
    crc = (crc >> 8) ^ Crc32Lookup[0][(crc & 0xFF) ^ *current++];

  return ~crc; // same as crc ^ 0xFFFFFFFF
}


/// compute CRC32 (Slicing-by-4 algorithm)
uint32_t crc32_4bytes(const void* data, size_t length, uint32_t previousCrc32)
{
  uint32_t  crc = ~previousCrc32; // same as previousCrc32 ^ 0xFFFFFFFF
  const uint32_t* current = (const uint32_t*) data;

  // process four bytes at once (Slicing-by-4)
  while (length >= 4)
  {
#if __BYTE_ORDER == __BIG_ENDIAN
    uint32_t one = *current++ ^ swap(crc);
    crc  = Crc32Lookup[0][ one      & 0xFF] ^
           Crc32Lookup[1][(one>> 8) & 0xFF] ^
           Crc32Lookup[2][(one>>16) & 0xFF] ^
           Crc32Lookup[3][(one>>24) & 0xFF];
#else
    uint32_t one = *current++ ^ crc;
    crc  = Crc32Lookup[0][(one>>24) & 0xFF] ^
           Crc32Lookup[1][(one>>16) & 0xFF] ^
           Crc32Lookup[2][(one>> 8) & 0xFF] ^
           Crc32Lookup[3][ one      & 0xFF];
#endif

    length -= 4;
  }

  const uint8_t* currentChar = (const uint8_t*) current;
  // remaining 1 to 3 bytes (standard algorithm)
  while (length-- > 0)
    crc = (crc >> 8) ^ Crc32Lookup[0][(crc & 0xFF) ^ *currentChar++];

  return ~crc; // same as crc ^ 0xFFFFFFFF
}


/// compute CRC32 (Slicing-by-8 algorithm)
uint32_t crc32_8bytes(const void* data, size_t length, uint32_t previousCrc32)
{
  uint32_t crc = ~previousCrc32; // same as previousCrc32 ^ 0xFFFFFFFF
  const uint32_t* current = (const uint32_t*) data;

  // process eight bytes at once (Slicing-by-8)
  while (length >= 8)
  {
#if __BYTE_ORDER == __BIG_ENDIAN
    uint32_t one = *current++ ^ swap(crc);
    uint32_t two = *current++;
    crc  = Crc32Lookup[0][ two      & 0xFF] ^
           Crc32Lookup[1][(two>> 8) & 0xFF] ^
           Crc32Lookup[2][(two>>16) & 0xFF] ^
           Crc32Lookup[3][(two>>24) & 0xFF] ^
           Crc32Lookup[4][ one      & 0xFF] ^
           Crc32Lookup[5][(one>> 8) & 0xFF] ^
           Crc32Lookup[6][(one>>16) & 0xFF] ^
           Crc32Lookup[7][(one>>24) & 0xFF];
#else
    uint32_t one = *current++ ^ crc;
    uint32_t two = *current++;
    crc  = Crc32Lookup[0][(two>>24) & 0xFF] ^
           Crc32Lookup[1][(two>>16) & 0xFF] ^
           Crc32Lookup[2][(two>> 8) & 0xFF] ^
           Crc32Lookup[3][ two      & 0xFF] ^
           Crc32Lookup[4][(one>>24) & 0xFF] ^
           Crc32Lookup[5][(one>>16) & 0xFF] ^
           Crc32Lookup[6][(one>> 8) & 0xFF] ^
           Crc32Lookup[7][ one      & 0xFF];
#endif

    length -= 8;
  }

  const uint8_t* currentChar = (const uint8_t*) current;
  // remaining 1 to 7 bytes (standard algorithm)
  while (length-- > 0)
    crc = (crc >> 8) ^ Crc32Lookup[0][(crc & 0xFF) ^ *currentChar++];

  return ~crc; // same as crc ^ 0xFFFFFFFF
}


// //////////////////////////////////////////////////////////
// constants


#if 0
// //////////////////////////////////////////////////////////
// test code


/// one gigabyte
const size_t NumBytes = 1024*1024*1024;
/// 4k chunks during last test
const size_t DefaultChunkSize = 4*1024;


#include <cstdio>
#include <ctime>
#ifdef _MSC_VER
#include <windows.h>
#endif

// timing
static double seconds()
{
#ifdef _MSC_VER
  LARGE_INTEGER frequency, now;
  QueryPerformanceFrequency(&frequency);
  QueryPerformanceCounter  (&now);
  return now.QuadPart / double(frequency.QuadPart);
#else
  return clock() / double(CLOCKS_PER_SEC);
#endif
}

int main(int, char**)
{
  printf("Please wait ...\n");

  // initialize
  char* data = new char[NumBytes];
  for (size_t i = 0; i < NumBytes; i++)
    data[i] = char(i & 0xFF);

  // re-use variables
  double startTime, duration;
  uint32_t crc;

  // bitwise
  startTime = seconds();
  crc = crc32_bitwise(data, NumBytes);
  duration  = seconds() - startTime;
  printf("bitwise        : CRC=%08X, %.3fs, %.3f MB/s\n",
         crc, duration, (NumBytes / (1024*1024)) / duration);

  // half-byte
  startTime = seconds();
  crc = crc32_halfbyte(data, NumBytes);
  duration  = seconds() - startTime;
  printf("half-byte      : CRC=%08X, %.3fs, %.3f MB/s\n",
         crc, duration, (NumBytes / (1024*1024)) / duration);

  // one byte at once
  startTime = seconds();
  crc = crc32_1byte(data, NumBytes);
  duration  = seconds() - startTime;
  printf("1 byte  at once: CRC=%08X, %.3fs, %.3f MB/s\n",
         crc, duration, (NumBytes / (1024*1024)) / duration);

  // four bytes at once
  startTime = seconds();
  crc = crc32_4bytes(data, NumBytes);
  duration  = seconds() - startTime;
  printf("4 bytes at once: CRC=%08X, %.3fs, %.3f MB/s\n",
         crc, duration, (NumBytes / (1024*1024)) / duration);

  // eight bytes at once
  startTime = seconds();
  crc = crc32_8bytes(data, NumBytes);
  duration  = seconds() - startTime;
  printf("8 bytes at once: CRC=%08X, %.3fs, %.3f MB/s\n",
         crc, duration, (NumBytes / (1024*1024)) / duration);

  // eight bytes at once, process in 4k chunks
  startTime = seconds();
  crc = 0; // also default parameter of crc32_xx functions
  size_t bytesProcessed = 0;
  while (bytesProcessed < NumBytes*16)
  {
    size_t bytesLeft = 16*NumBytes - bytesProcessed;
    size_t chunkSize = (DefaultChunkSize < bytesLeft) ? DefaultChunkSize : bytesLeft;

    crc = crc32_8bytes(data+bytesProcessed, chunkSize, crc);

    bytesProcessed += chunkSize;
  }
  duration  = seconds() - startTime;
  printf("chunked        : CRC=%08X, %.3fs, %.3f MB/s\n",
    crc, duration, (NumBytes / (1024*1024)) / duration);

  delete[] data;
  return 0;
}
#endif
